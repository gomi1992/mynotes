# 抢券抢票系统思考
tags = #秒杀 #抢购 #web #MessageQueue #redis

# 秒杀
秒杀系统特点

- 瞬时流量大
- 要求响应快

# 方案一
什么优化都不做，全部交给数据库处理。

这个方案十分依赖数据库的性能。一旦数据库崩溃，则整个服务崩溃。

同时，数据库读写硬盘，硬盘io较低，流量大的情况下无法胜任。

mysql能够在普通家用机上支撑1s10次的请求。

数据库上需要加乐观锁或悲观锁，以保证不会多卖，但仍然存在多卖的情况。

# 方案二
给数据库加上一层缓冲。

使用基于内存的数据库作为数据库（如redis）缓冲，能够有效的减轻压力。

但没有解决多卖的问题。

用户等待时间较长。

# 方案三

目前性能最优方案
- redis作为token服务器，用户只有取到了token才能进行下一步。
- mq（MessageQueue）作为缓冲，取得了token，在mq中加入消息
- 处理线程从mq中取消息，往数据库中插数据

用户等待时间短，立刻可以知道是否抢到（因为redis单线程模型以及token设计）。

不会超卖，以为有token设计。

系统复杂，需要针对redis编写lua脚本。